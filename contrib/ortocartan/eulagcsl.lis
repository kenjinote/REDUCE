(setq infoeulagr '(This is the program Eulagr that calculates the Euler-
Lagrange equations from a given lagrangian!. The number of lagrangian
functions is arbitrary!, but they must all be functions of the same
single variable!. The program can run only on top of the program
Ortocartan!.))

(de EULAGRINIT (L) (PROG (V V1 ARRAY MEM GLS)
    (TERPRI) (TERPRI)
    (PRINTC (CAR L))
    (TERPRI) (TERPRI)
    (MAPC (CDR L) (FUNCTION (LAMBDA (LE) (SELECT (CAR LE)
        ((QUOTE PARAMETER)   (SETQ COORD (CDR LE)))
        ((QUOTE FUNCTIONS)   (SETQ FUNCTIONS (CDR LE)))
        ((QUOTE CONSTANTS)   (SETQ CONSTANTS (CDR LE)))
        ((QUOTE SYMBOLS)   (SETQ METSUBS (CDR LE)))
        ((QUOTE SUBSTITUTIONS)   (SETQ SIMPLSUBS (CDR LE)))
        ((QUOTE DONT)   (SETQ NOPRINT (CDDR LE)))
        ((QUOTE STOP)   (SETQ STOP (CADDR LE)))
        ((QUOTE DATA)   (SETQ DATASUBS (CDDR LE)))
        ((QUOTE EXPAND)   (PROG2 (SETQ LPOWER (CADDDR LE))
                                 (SETQ UPOWER (CADR (CDDDDR LE))) ))
        ((QUOTE MARKERS)   (SETQ MARKERS (CDR LE)))
        ((QUOTE RMARGIN)   (SETQ RMARGIN (CADR LE)))
        ((QUOTE LMARGIN)   (SETQ LMARGIN (CADR LE)))
        ((QUOTE VARIABLES)   (SETQ LAGVARS (CDR LE)))
        ((QUOTE LAGRANGIAN)   (SETQ LAGRAN (CADR LE)))
        ((QUOTE OUTPUT)   (COND
           ((EQUAL LE (QUOTE (OUTPUT FOR INPUT)))
                                     (SETQ OUTINP (QUOTE INPUT)))
           ((EQUAL LE (QUOTE (OUTPUT FOR LATEX)))
                                     (SETQ OUTINP (QUOTE LATEX)))
           (T          (ERROR (LIST (QUOTE "*****///") LE (QUOTE "///*****")
                                    (QUOTE "IS AN ILLEGAL ARGUMENT")
                                    (QUOTE "FOR OUR SYSTEM.")
                                    (QUOTE "SORRY, CAN'T GO ON."))) )))
        (ERROR (LIST (QUOTE "*****///") LE (QUOTE "///*****")
                          (QUOTE "IS AN ILLEGAL ARGUMENT")
                          (QUOTE "FOR OUR SYSTEM.")
                                    (QUOTE "SORRY, CAN'T GO ON")))) )))
    (OR LAGVARS (ERROR (LIST (QUOTE "YOU DID NOT SPECIFY")
                     (QUOTE "WHICH FUNCTIONS ARE THE")
                     (QUOTE "LAGRANGIAN VARIABLES.")
                     (QUOTE "PLEASE ADD THE ARGUMENT")
                     (QUOTE "*****///VARIABLES///****")
                     (QUOTE "IN THE INPUT DATA") )))
    (OR COORD (ERROR (LIST (QUOTE "YOU DID NOT SPECIFY THE NAME OF")
                           (QUOTE "THE PARAMETER UNDER THE")
                           (QUOTE "ACTION INTEGRAL. I CANNOT DO MY")
                           (QUOTE "JOB WITHOUT THIS INFORMATION.")
                           (QUOTE "SORRY, TRY AGAIN PLEASE.")) ))
    (SETQ MESS (NOT (MEMQ (QUOTE MESSAGES) NOPRINT)))
    (OR LPOWER (SETQ LPOWER 2))
    (OR UPOWER (SETQ UPOWER 3))
    (AND (GREATERP RMARGIN 72) (LINELENGTH RMARGIN))
    (MAP METSUBS (FUNCTION (LAMBDA (ME)
                 (RPLACA ME (INTOPRE (CAR ME))) )))
    (LISTDEPS)
    (DEFSYMB)
    (MAKEPAIRS)
    (PUTSYMB)
    (SETQ LAGRAN (SIMPLIFY (INTOPRE LAGRAN) T))
    (OR (MEMQ (QUOTE LAGRANGIAN) NOPRINT) (PROG2
        (INPRINT (QUOTE LAGRANGIAN) NIL NIL (QUOTE =) LAGRAN)
        (TERPRI) ))
    (MAP DATASUBS (FUNCTION (LAMBDA (DE)
         (RPLACA DE (SIMPLIFY (INTOPRE (CAR DE)) T)) )))
    (AND SYMBOLS (PROGN
         (MESSAGE (QUOTE SYMBOLS) T)
         (TURNCAR)
         (MAPC SYMBOLS (FUNCTION (LAMBDA (SE) (PROG2
               (INPRINT SE NIL NIL (QUOTE =) (GET SE (QUOTE CONTENT)))
               (TURNCAR)) ))) ))
    (MAPC MARKERS (FUNCTION (LAMBDA (ME) (SET ME NIL) )))
    (AND SIMPLSUBS (PROG (S M L DGLS M!?)
         (OR (SETQ MEM (MEMQ (QUOTE SUBSTITUTIONS) NOPRINT)) (PROG2
             (MESSAGE (QUOTE SUBSTITUTIONS) T)
             (TURNCAR)))
         (SETQ S (QUOTE =))
         (SETQ V SIMPLSUBS)
         (AND MARKERS (SETQ GLS
              (MAPCAR V (FUNCTION (LAMBDA (VE) (AND (EQ VE S) S) ))) )
              (SETQ DGLS GLS))
       A (OR (SETQ M (FRONT (SETQ L (PREVIOUS S V)) V)) MEM
             (MESSAGE (QUOTE EVERYWHERE) T))
         (SETQ V (MEMBER L V))
         (OR MEM (PROGN
             (MAPC M (FUNCTION (LAMBDA (ME) (PROG2
                (MESSAGE ME NIL)
                (MESSAGE BLANK NIL)) )))
             (TURNCAR) (TURNCAR) ))
         (RPLACA V (INTOPRE (CAR V)))
         (COND (M!?   (PROGN (SETQ DGLS (EQUATE V DGLS))
                            (RPLACA DGLS T)
                            (RPLACA V (SMOOTH (CAR V) T))
                            (SETQ M!? NIL)))
               (T   (RPLACA V (SIMPLIFY (CAR V) T))))
         (RPLACA (CDDR V) (SIMPLIFY (INTOPRE (CADDR V)) T))
         (SETQ M!? NIL)
         (AND (EQ (CADDR V) (QUOTE EXPAND)) (COND
              ((AND (NOT (ATOM (CAR V))) (EQ (CAAR V) (QUOTE EXPT))
                    (CDAR V) (CDDAR V) (NULL (CDDDAR V)))
                        (OR (AND DGLS (CAR DGLS)) (RPLACA (CDDR V)
                                      (DEVELOP (CADAR V) (CADDAR V))) ))
              (T   (ERROR (LIST (QUOTE "THE EXPRESSION *****///")
                      (CAR V) (QUOTE "///***** IS NOT AN EXPONENTIAL")
                      (QUOTE "EXPRESSION, AND SO THE COMMAND")
                      (QUOTE "** EXPAND ** IS MEANINGLESS IN THIS")
                      (QUOTE "CASE. SORRY, MUST QUIT."))) )))
         (OR MEM (PROGN
             (INPRINT (CAR V) NIL NIL S (CADDR V))
             (TURNCAR) (TURNCAR) ))
         (AND (SETQ V (CDDDR V)) (GO A)) ))
    (AND DATASUBS (PROG (GL)
         (PROG ( ) (MESSAGE (QUOTE (THE SUBSTITUTIONS LISTED ABOVE WILL
                            BE THEMSELVES TRANSFORMED BY THE FOLLOWING
                            SUBSTITUTIONS)) T)
                   (SETQ V DATASUBS)
                 A (COND ((EQ (CADR V) (QUOTE =))
                                         (MESSAGE (QUOTE EVERYWHERE) T))
                         (T   (MAPC (FRONT (PREVIOUS (QUOTE =) V) V)
                                    (FUNCTION (LAMBDA (FE) (PROG2
                                    (INPRINT (QUOTE "IN THE VALUE") NIL
                                       NIL (QUOTE "OF THE EXPRESSION")
                                       (CAR V))
                                    (SETQ V (CDR V))) ))) ))
                   (INPRINT (CAR V) NIL NIL (QUOTE =) (CADDR V))
                   (AND (SETQ V (CDDDR V)) (GO A)))
         (SETQ GL (MAPCAR SIMPLSUBS (FUNCTION (LAMBDA (SE)
                          (AND (EQ SE (QUOTE =)) SE) ))) )
         (CLEARDATA)
         (REMPROP (QUOTE CLEARDATA) (QUOTE EXPR))
         (REMPROP (QUOTE EQUATE) (QUOTE EXPR))
         (SETQ DATASUBS NIL)
         (OR (MEMQ (QUOTE MODIFICATIONS) NOPRINT) (PROGN
             (MESSAGE (QUOTE (THE SUBSTITUTIONS YOU ASKED ME TO
                 MODIFY WILL HAVE THE FOLLOWING FINAL FORM)) T)
             (TURNCAR) (TURNCAR) (TURNCAR)
             (PROG (S M L)
                 (SETQ S (QUOTE =))
                 (SETQ V SIMPLSUBS)
              A  (COND ((OR (PREVIOUS S GL) (NEXT S GL)) (PROGN
                            (OR (SETQ M (REMOVELAST (FRONT S V)))
                                (MESSAGE (QUOTE EVERYWHERE) T))
                            (MAPC M (FUNCTION (LAMBDA (ME) (PROGN
                                  (SETQ V (CDR V))
                                  (MESSAGE ME NIL)
                                  (MESSAGE BLANK NIL)) )))
                            (TURNCAR) (TURNCAR)
                            (INPRINT (CAR V) NIL NIL S (CADDR V))
                            (TURNCAR) (TURNCAR)
                            (AND (SETQ V (CDDDR V))
                                 (SETQ GL (CDDR (MEMQ S GL)))
                                 (GO A)) ))
                       (T   (AND (SETQ GL (CDDR (MEMQ S GL)))
                                 (SETQ V (CDDR (MEMQ S V)))
                                 (GO A))) ))) )))
    (SETQ N 0)
    (SETQ LIND (CONS N NIL))
    (MAPC LAGVARS (FUNCTION (LAMBDA (LE)
        (SETQ LIND (CONS (SETQ N (ADD1 N)) LIND)) )))
    (SETQ LIND (REVERSIP LIND))
    (SETQ SIMPLSUBS (SUBSTITUTIONS SIMPLSUBS))
                       ))
(de EULAGR (LIS)
    (PROG (COORD FUNCTIONS CONSTANTS EMATRIX METSUBS SIMPLSUBS NOPRINT
           STOP TENSORS DATASUBS IE AGAM GAM RM RC RINV
           FUNNAMES SYMBOLS UPIE LPOWER UPOWER WORKARR WV LIND LIJ LIJK
           LIJKL LAB LABC LABCD MESS MARKERS LMARGIN CLOCK
           VELO EXPA ATIDA VTIDA ACCE SHEAR ROT ELWEYL
           MAGWEYL VMATRIX UVELO LVELO METRIC INVMETRIC CHRIS UACCE
           LACCE ROTDD ROTDU SHEARDD SHEARDU PROJDD PROJDU DETEM OUTINP
           LAGVARS LAGRAN DUPLAG1 DUPLAG2 N X V V1 W RES)
    (MAPC (OBLIST) (FUNCTION RESETVARS))
    (SETQ CLOCK (TIME))
    (SETQ RMARGIN 72)
    (SETQ LMARGIN  8)
    (EULAGRINIT LIS)
    (RPLACD LIS NIL)
    (SETQ V (CAR COORD))
    (SETQ X (GENSYM))
    (PUT X (QUOTE PRIOR) -1)
    (SETQ LABC (COPY LIND))
    (MAPC NOPRINT (FUNCTION (LAMBDA (LE) (OR (ATOM LE)
        (AND (EQ (CAR LE) (QUOTE EULAGR)) (SETQ NOPRINT (CDR LE)) )) )))
    (AND STOP (NOT (ATOM STOP)) (EQ (CAR STOP) (QUOTE EULAGR))
         (SETQ STOP (CAADR STOP)))
    (MAP LAGVARS (FUNCTION (LAMBDA (LE) (PROGN
        (SETQ W (LIST (QUOTE DER) V (CAR LE)))
        (SETQ DUPLAG1 (SUBSTITUTE W X (COPY LAGRAN)))
        (SETQ COORD (CONS X COORD))
        (SETQ DUPLAG2 (SMINUS (DERIV (CAR LE) DUPLAG1)))
        (SETQ DUPLAG1 (DERIV X DUPLAG1))
        (SETQ DUPLAG1 (SUBSTITUTE X W DUPLAG1))
        (SETQ COORD (CDR COORD))
        (SETQ DUPLAG1 (DERIV V DUPLAG1))
        (SETQ DUPLAG2 (SUBSTITUTE X W DUPLAG2))
        (SETQ RES (SPLUS (LIST DUPLAG1 DUPLAG2)))
        (SETQ V1 (CONS (CAR LABC) NIL))
        (SUBSALL (QUOTE RES) (QUOTE EULAGR) NIL V1 SIMPLSUBS)
        (OR (MEMBER V1 NOPRINT) (PROGN
            (PRINTC (LIST (QUOTE "THIS IS THE VARIATIONAL")
                         (QUOTE "DERIVATIVE BY") (CAR LE)))
            (TERPRI)
            (INPRINT (QUOTE EULAGR) NIL V1 (QUOTE =) RES)
            (TERPRI) ))
        (SETQ LABC (CDR LABC))
        (AND (EQN STOP (CAR V1)) (RPLACD LE NIL)) ))))
    (LINELENGTH 72)
    (TERPRI) (TERPRI)
    (MESSAGE (QUOTE ("I REALLY LIKED THIS!" "CAN I HAVE MORE ?"
                                           "  PLEASE ?!?")) T)
    (TERPRI)
    (MESSAGE (QUOTE "END OF WORK") T)
    (MESSAGE (LIST (QUOTE "RUN TIME =") (PLUS (TIME) (MINUS CLOCK))
                   (QUOTE MSEC)) T)
     ))
